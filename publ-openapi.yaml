openapi: 3.0.3
info:
  title: uCoz API - Publ Module
  description: |
    API документация для модуля "Каталог статей" uCoz.
    
    ## Авторизация OAuth 1.0
    
    Все запросы к API требуют авторизации по протоколу OAuth 1.0.
  version: 1.0.0
  contact:
    name: uCoz API Support
    url: https://api.ucoz.net

servers:
  - url: http://yoursite.ucoz.ru/uapi
    description: Базовый URL вашего сайта

security:
  - OAuth1: []

paths:
  /publ:
    get:
      summary: Получить все материалы модуля
      description: Получить список всех материалов модуля "Каталог статей"
      operationId: getPublEntries
      tags:
        - Entries
      parameters:
        - name: page
          in: query
          description: Номер страницы
          required: false
          schema:
            type: integer
        - name: id
          in: query
          description: ID определенного материала
          required: false
          schema:
            type: integer
        - name: category
          in: query
          description: ID категории
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublEntriesResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Добавить материал
      description: Добавить новый материал в модуль "Каталог статей"
      operationId: addPublEntry
      tags:
        - Entries
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - category
              properties:
                category:
                  type: integer
                  description: ID категории (обязательно)
                title:
                  type: string
                  description: Название материала
                description:
                  type: string
                  description: Краткое описание материала
                message:
                  type: string
                  description: Полное описание материала
                comments:
                  type: string
                  enum: [yes, no]
                ontop:
                  type: string
                  enum: [yes, no]
                pending:
                  type: string
                  enum: [yes, no]
                file1:
                  type: string
                  format: binary
                  description: Изображение материала (file2, file3 для нескольких)
                author:
                  type: string
                  description: Имя автора
                author_email:
                  type: string
                  format: email
                  description: Email автора
                author_site:
                  type: string
                  format: uri
                  description: Веб-сайт автора
                link2source:
                  type: string
                  format: uri
                  description: Источник материала
                other1:
                  type: string
                other2:
                  type: string
                other3:
                  type: string
                other4:
                  type: string
                other5:
                  type: string
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublEntryResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Отредактировать материал
      description: Отредактировать существующий материал
      operationId: updatePublEntry
      tags:
        - Entries
      parameters:
        - name: id
          in: query
          description: ID материала
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                message:
                  type: string
                comments:
                  type: string
                  enum: [yes, no]
                ontop:
                  type: string
                  enum: [yes, no]
                pending:
                  type: string
                  enum: [yes, no]
                hgu_title:
                  type: string
                file1:
                  type: string
                  format: binary
                author:
                  type: string
                author_email:
                  type: string
                  format: email
                author_site:
                  type: string
                  format: uri
                link2source:
                  type: string
                  format: uri
                other1:
                  type: string
                other2:
                  type: string
                other3:
                  type: string
                other4:
                  type: string
                other5:
                  type: string
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublEntryResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /publ/posts:
    delete:
      summary: Удалить материал
      description: Удалить материал из модуля
      operationId: deletePublEntry
      tags:
        - Entries
      parameters:
        - name: id
          in: query
          description: ID материала
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /publ/tags:
    post:
      summary: Добавить/изменить теги материала
      description: Добавить, изменить или удалить теги к материалу
      operationId: updatePublTags
      tags:
        - Entries
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
                  description: ID материала
                tags:
                  type: string
                  description: Список тегов через запятую
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /publ/category:
    get:
      summary: Получить список категорий/разделов
      description: Получить все категории и разделы модуля
      operationId: getPublCategories
      tags:
        - Categories
      parameters:
        - name: id
          in: query
          description: ID определенной категории
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoriesResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Добавить категорию/раздел
      description: Добавить новую категорию или раздел
      operationId: addPublCategory
      tags:
        - Categories
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  description: Название категории/раздела
                description:
                  type: string
                hgu_title:
                  type: string
                position:
                  type: integer
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoryResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Отредактировать категорию/раздел
      description: Отредактировать существующую категорию или раздел
      operationId: updatePublCategory
      tags:
        - Categories
      parameters:
        - name: id
          in: query
          description: ID категории
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                hgu_title:
                  type: string
                position:
                  type: integer
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoryResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Удалить категорию/раздел
      description: Удалить категорию или раздел
      operationId: deletePublCategory
      tags:
        - Categories
      parameters:
        - name: id
          in: query
          description: ID категории
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /publ/comments:
    get:
      summary: Получить комментарии материала
      description: Получить все комментарии к определенному материалу
      operationId: getPublComments
      tags:
        - Comments
      parameters:
        - name: id
          in: query
          description: ID материала
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentsResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Добавить комментарий
      description: Добавить комментарий к материалу
      operationId: addPublComment
      tags:
        - Comments
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - id
                - message
              properties:
                id:
                  type: integer
                  description: ID материала
                message:
                  type: string
                  description: Текст комментария
                parent_id:
                  type: integer
                  description: ID родительского комментария
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Отредактировать комментарий
      description: Отредактировать существующий комментарий
      operationId: updatePublComment
      tags:
        - Comments
      parameters:
        - name: id
          in: query
          description: ID комментария
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                message:
                  type: string
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Удалить комментарий
      description: Удалить комментарий
      operationId: deletePublComment
      tags:
        - Comments
      parameters:
        - name: id
          in: query
          description: ID комментария
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        default:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    OAuth1:
      type: oauth
      description: OAuth 1.0 авторизация для uCoz API
      flows:
        authorizationCode:
          authorizationUrl: 'https://www.ucoz.ru/'
          tokenUrl: 'https://www.ucoz.ru/'
          scopes: {}

  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: object

    SuccessResponse:
      type: object
      properties:
        success:
          type: object
          properties:
            msg:
              type: string

    PublEntry:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        hgu_title:
          type: string
        description:
          type: string
        message:
          type: string
        entry_url:
          type: string
          format: uri
        author:
          type: string
        author_email:
          type: string
          format: email
        author_site:
          type: string
          format: uri
        link2source:
          type: string
          format: uri
        add_date:
          type: string
        reads:
          type: integer
        comments:
          type: string
          enum: [yes, no]
        ontop:
          type: string
          enum: [yes, no]
        pending:
          type: string
          enum: [yes, no]
        rating:
          type: number
        rate_num:
          type: integer
        rate_sum:
          type: integer
        categories:
          type: array
          items:
            $ref: '#/components/schemas/Category'
        files:
          type: array
          items:
            type: object
            properties:
              small:
                type: string
                format: uri
              full:
                type: string
                format: uri
        other1:
          type: string
        other2:
          type: string
        other3:
          type: string
        other4:
          type: string
        other5:
          type: string

    PublEntriesResponse:
      type: object
      properties:
        page:
          type: integer
        pages_list:
          type: string
        per_page:
          type: integer
        publ:
          type: array
          items:
            $ref: '#/components/schemas/PublEntry'
        total_publ:
          type: integer

    PublEntryResponse:
      allOf:
        - $ref: '#/components/schemas/PublEntry'

    Category:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        url:
          type: string
          format: uri
        hgu_title:
          type: string
        position:
          type: integer
        entry_count:
          type: integer
        access2category:
          type: array
        access2add:
          type: array
        access2upload:
          type: array

    CategoriesResponse:
      type: array
      items:
        $ref: '#/components/schemas/Category'

    CategoryResponse:
      allOf:
        - $ref: '#/components/schemas/Category'

    Comment:
      type: object
      properties:
        id:
          type: integer
        message:
          type: string
        author:
          type: string
        add_date:
          type: string
        parent_id:
          type: integer
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Comment'

    CommentsResponse:
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Comment'

    CommentResponse:
      allOf:
        - $ref: '#/components/schemas/Comment'
